{"version":3,"sources":["src/pages/user/register/service.ts","src/pages/user/register/styles.ts","src/pages/user/register/index.tsx"],"sourcesContent":["import { request } from '@umijs/max';\n\nexport interface StateType {\n  status?: 'ok' | 'error';\n  currentAuthority?: 'user' | 'guest' | 'admin';\n}\n\nexport interface UserRegisterParams {\n  mail: string;\n  password: string;\n  confirm: string;\n  mobile: string;\n  captcha: string;\n  prefix: string;\n}\n\nexport async function fakeRegister(params: UserRegisterParams) {\n  return request('/api/register', {\n    method: 'POST',\n    data: params,\n  });\n}\n","import { createStyles } from 'antd-style';\n\nconst useStyles = createStyles(({ token }) => {\n  return {\n    main: {\n      width: '368px',\n      margin: '0 auto',\n      h3: { marginBottom: '20px', fontSize: '16px' },\n    },\n    password: {\n      marginBottom: '24px',\n      '.ant-form-item-explain': { display: 'none' },\n    },\n    getCaptcha: {\n      display: 'block',\n      width: '100%',\n    },\n\n    footer: {\n      width: '100%',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n    },\n    submit: {\n      width: '50%',\n    },\n    success: {\n      transition: 'color 0.3s',\n      color: token.colorSuccess,\n    },\n    warning: {\n      transition: 'color 0.3s',\n      color: token.colorWarning,\n    },\n    error: {\n      transition: 'color 0.3s',\n      color: token.colorError,\n    },\n    'progress-pass > .progress': {\n      '.ant-progress-bg': { backgroundColor: token.colorWarning },\n    },\n  };\n});\n\nexport default useStyles;\n","import { history, Link, useRequest } from '@umijs/max';\nimport {\n  Button,\n  Col,\n  Form,\n  Input,\n  message,\n  Popover,\n  Progress,\n  Row,\n  Select,\n  Space,\n} from 'antd';\nimport type { Store } from 'antd/es/form/interface';\nimport type { FC } from 'react';\nimport { useEffect, useState } from 'react';\nimport type { StateType } from './service';\nimport { fakeRegister } from './service';\nimport useStyles from './styles';\n\nconst FormItem = Form.Item;\nconst { Option } = Select;\n\nconst passwordProgressMap: {\n  ok: 'success';\n  pass: 'normal';\n  poor: 'exception';\n} = {\n  ok: 'success',\n  pass: 'normal',\n  poor: 'exception',\n};\nconst Register: FC = () => {\n  const { styles } = useStyles();\n  const [count, setCount]: [number, any] = useState(0);\n  const [open, setVisible]: [boolean, any] = useState(false);\n  const [prefix, setPrefix]: [string, any] = useState('86');\n  const [popover, setPopover]: [boolean, any] = useState(false);\n  const confirmDirty = false;\n  let interval: number | undefined;\n\n  const passwordStatusMap = {\n    ok: (\n      <div className={styles.success}>\n        <span>强度：强</span>\n      </div>\n    ),\n    pass: (\n      <div className={styles.warning}>\n        <span>强度：中</span>\n      </div>\n    ),\n    poor: (\n      <div className={styles.error}>\n        <span>强度：太短</span>\n      </div>\n    ),\n  };\n\n  const [form] = Form.useForm();\n  useEffect(\n    () => () => {\n      clearInterval(interval);\n    },\n    [interval],\n  );\n  const onGetCaptcha = () => {\n    let counts = 59;\n    setCount(counts);\n    interval = window.setInterval(() => {\n      counts -= 1;\n      setCount(counts);\n      if (counts === 0) {\n        clearInterval(interval);\n      }\n    }, 1000);\n  };\n  const getPasswordStatus = () => {\n    const value = form.getFieldValue('password');\n    if (value && value.length > 9) {\n      return 'ok';\n    }\n    if (value && value.length > 5) {\n      return 'pass';\n    }\n    return 'poor';\n  };\n  const { loading: submitting, run: register } = useRequest<{\n    data: StateType;\n  }>(fakeRegister, {\n    manual: true,\n    onSuccess: (data, params) => {\n      if (data.status === 'ok') {\n        message.success('注册成功！');\n        history.push({\n          pathname: `/user/register-result?account=${params[0].email}`,\n        });\n      }\n    },\n  });\n  const onFinish = (values: Store) => {\n    register(values);\n  };\n  const checkConfirm = (_: any, value: string) => {\n    const promise = Promise;\n    if (value && value !== form.getFieldValue('password')) {\n      return promise.reject('两次输入的密码不匹配!');\n    }\n    return promise.resolve();\n  };\n  const checkPassword = (_: any, value: string) => {\n    const promise = Promise;\n    // 没有值的情况\n    if (!value) {\n      setVisible(!!value);\n      return promise.reject('请输入密码!');\n    }\n    // 有值的情况\n    if (!open) {\n      setVisible(!!value);\n    }\n    setPopover(!popover);\n    if (value.length < 6) {\n      return promise.reject('');\n    }\n    if (value && confirmDirty) {\n      form.validateFields(['confirm']);\n    }\n    return promise.resolve();\n  };\n  const changePrefix = (value: string) => {\n    setPrefix(value);\n  };\n  const renderPasswordProgress = () => {\n    const value = form.getFieldValue('password');\n    const passwordStatus = getPasswordStatus();\n    return value?.length ? (\n      <div\n        className={styles[`progress-${passwordStatus}` as keyof typeof styles]}\n      >\n        <Progress\n          status={passwordProgressMap[passwordStatus]}\n          strokeWidth={6}\n          percent={value.length * 10 > 100 ? 100 : value.length * 10}\n          showInfo={false}\n        />\n      </div>\n    ) : null;\n  };\n  return (\n    <div className={styles.main}>\n      <h3>注册</h3>\n      <Form form={form} name=\"UserRegister\" onFinish={onFinish}>\n        <FormItem\n          name=\"email\"\n          rules={[\n            {\n              required: true,\n              message: '请输入邮箱地址!',\n            },\n            {\n              type: 'email',\n              message: '邮箱地址格式错误!',\n            },\n          ]}\n        >\n          <Input size=\"large\" placeholder=\"邮箱\" />\n        </FormItem>\n        <Popover\n          getPopupContainer={(node) => {\n            if (node?.parentNode) {\n              return node.parentNode as HTMLElement;\n            }\n            return node;\n          }}\n          content={\n            open && (\n              <div\n                style={{\n                  padding: '4px 0',\n                }}\n              >\n                {passwordStatusMap[getPasswordStatus()]}\n                {renderPasswordProgress()}\n                <div\n                  style={{\n                    marginTop: 10,\n                  }}\n                >\n                  <span>请至少输入 6 个字符。请不要使用容易被猜到的密码。</span>\n                </div>\n              </div>\n            )\n          }\n          overlayStyle={{\n            width: 240,\n          }}\n          placement=\"right\"\n          open={open}\n        >\n          <FormItem\n            name=\"password\"\n            className={\n              form.getFieldValue('password') &&\n              form.getFieldValue('password').length > 0 &&\n              styles.password\n            }\n            rules={[\n              {\n                validator: checkPassword,\n              },\n            ]}\n          >\n            <Input\n              size=\"large\"\n              type=\"password\"\n              placeholder=\"至少6位密码，区分大小写\"\n            />\n          </FormItem>\n        </Popover>\n        <FormItem\n          name=\"confirm\"\n          rules={[\n            {\n              required: true,\n              message: '确认密码',\n            },\n            {\n              validator: checkConfirm,\n            },\n          ]}\n        >\n          <Input size=\"large\" type=\"password\" placeholder=\"确认密码\" />\n        </FormItem>\n        <FormItem\n          name=\"mobile\"\n          rules={[\n            {\n              required: true,\n              message: '请输入手机号!',\n            },\n            {\n              pattern: /^\\d{11}$/,\n              message: '手机号格式错误!',\n            },\n          ]}\n        >\n          <Space.Compact style={{ width: '100%' }}>\n            <Select\n              size=\"large\"\n              value={prefix}\n              onChange={changePrefix}\n              style={{\n                width: '30%',\n              }}\n            >\n              <Option value=\"86\">+86</Option>\n              <Option value=\"87\">+87</Option>\n            </Select>\n\n            <Input size=\"large\" placeholder=\"手机号\" />\n          </Space.Compact>\n        </FormItem>\n        <Row gutter={8}>\n          <Col span={16}>\n            <FormItem\n              name=\"captcha\"\n              rules={[\n                {\n                  required: true,\n                  message: '请输入验证码!',\n                },\n              ]}\n            >\n              <Input size=\"large\" placeholder=\"验证码\" />\n            </FormItem>\n          </Col>\n          <Col span={8}>\n            <Button\n              size=\"large\"\n              disabled={!!count}\n              className={styles.getCaptcha}\n              onClick={onGetCaptcha}\n            >\n              {count ? `${count} s` : '获取验证码'}\n            </Button>\n          </Col>\n        </Row>\n        <FormItem>\n          <div className={styles.footer}>\n            <Button\n              size=\"large\"\n              loading={submitting}\n              className={styles.submit}\n              type=\"primary\"\n              htmlType=\"submit\"\n            >\n              <span>注册</span>\n            </Button>\n            <Link to=\"/user/login\">\n              <span>使用已有账户登录</span>\n            </Link>\n          </div>\n        </FormItem>\n      </Form>\n    </div>\n  );\n};\nexport default Register;\n"],"names":[],"mappings":"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"}